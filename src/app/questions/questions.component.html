<div class="main-content">
  <div class="project-info">
    <div class="project-name">
      <h4>Project: {{projectData?.project_name}}</h4>
    </div>
    <div class="unit">
      <h4>Business Unit: {{projectData?.bu_name}}</h4>
    </div>
    <div class="sub-unit">
      <h4>Sub Business: {{projectData?.sub_bu_name}}</h4>
    </div>
  </div>

  <!-- {{currentCategory | json}} -->
  <!-- {{projectData | json}} -->

  <div class="add-category">
    <div class="add-button">
      
        <a class="mdc-chip" target="_blank"  routerLink="/checklist/{{projectId}}">
            <!-- <img src="{{projectService.getImagepath()}}/Group 142.svg" alt="icon"> -->
            <mat-icon>visibility
          </mat-icon>
            <span class="mdc-chip__text">Preview</span>
        </a>

      <button class="mdc-chip" (click)="openCategoryDialog('Add', {})">
        <img src="{{projectService.getImagepath()}}/Group 142.svg" alt="icon">
        <span class="mdc-chip__text">Add Category</span>
      </button>
      <mat-menu #category="matMenu">
        <button mat-menu-item (click)="openCreateCDialog()">Create new Category</button>
        <button mat-menu-item (click)="openExistingCategory()">Select Existing Category</button>
      </mat-menu>
    </div>
    <mat-card *ngIf="projectData?.categories?.length == 0" style="text-align: center">
      <h4>Category is empty</h4>
    </mat-card>
  </div>
  <mat-accordion>
    <ng-container *ngFor="let p of projectData?.categories;let i = index">
      <mat-expansion-panel [expanded]="i+1 === projectData.length" (opened)="setCurrentCategory(p)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <b> {{i+1}}. {{p.name}} </b>
          </mat-panel-title>
          <mat-icon (click)="openCategoryDialog('Delete', p);$event.stopPropagation();" matTooltip="Delete This Category" matTooltipClass="tooltip-blue"
            matTooltipPosition="above">delete</mat-icon>
          <mat-icon matTooltip="Edit This Category" matTooltipClass="tooltip-blue" matTooltipPosition="above"
            (click)="openCategoryDialog('Update', p);$event.stopPropagation();">edit
          </mat-icon>
          <mat-icon (click)="openCategoryDialog('View', p);$event.stopPropagation();" matTooltip="View Categry" matTooltipClass="tooltip-blue"
            matTooltipPosition="above">visibility
          </mat-icon>
        </mat-expansion-panel-header>
        <mat-panel-description>
          <div class="add-category">
            <div class="add-button">
              <button class="mdc-chip" (click)="openQuestionsDialog('Add', { parentid: ''})" style="background-color: rgb(18, 179, 243)">
                <img src="{{projectService.getImagepath()}}/Group 142.svg" alt="icon">
                <span class="mdc-chip__text">Add Questions</span>
              </button>
            </div>
            <mat-card *ngIf="currentCategory.questions?.length == 0" style="text-align: center">
              <h4> There is no question for this category </h4>
            </mat-card>
          </div>
          <ng-container *ngFor="let l1 of currentCategory.questions | mainQuestions;let i = index">
            <mat-card>
              <!-- <button mat-mini-fab color="primary">P.Q 
                        .</button> -->
              {{i+1}}. {{l1.question}}

              <mat-card-actions>
                <div class="subQues" (click)="openQuestionsDialog('Add', { parentid: l1.id })">
                  <mat-icon aria-hidden="false" aria-label="Example home icon" style="width: 20px">add_circle</mat-icon>
                  Sub Questions
                </div>

                <mat-icon matTooltip="Delete This Questions" matTooltipClass="tooltip-blue" matTooltipPosition="above"
                (click)="openQuestionsDialog('Delete', l1)">delete</mat-icon>
                <mat-icon (click)="openQuestionsDialog('Update', l1)" matTooltip="Edit This Question"
                  matTooltipClass="tooltip-blue" matTooltipPosition="above">edit
                </mat-icon>
                <mat-icon (click)="openQuestionsDialog('View', l1)" matTooltip="View Categry"
                  matTooltipClass="tooltip-blue" matTooltipPosition="above">visibility
                </mat-icon>
              </mat-card-actions>
              <ng-container *ngFor="let l2 of currentCategory.questions | subQuestions: l1.id; let j = index">
                <mat-card class="level2">
                  <button *ngIf="l2.answer_opt == 1" mat-mini-fab color="primary">Yes</button> <button mat-mini-fab
                    color="warn" *ngIf="l2.answer_opt == 2">No</button> <button *ngIf="l2.answer_opt == 3" mat-mini-fab
                    class="both">Both</button> {{j+1}}. {{l2.question}}

                  <mat-card-actions>
                    <div class="subQues" (click)="openQuestionsDialog('Add', { parentid: l2.id })">
                      <mat-icon aria-hidden="false" aria-label="Example home icon" style="width: 20px">add_circle
                      </mat-icon>
                      Sub Questions
                    </div>

                    <mat-icon matTooltip="Delete This Questions" matTooltipClass="tooltip-blue"
                      matTooltipPosition="above" (click)="openQuestionsDialog('Delete', l2)">delete</mat-icon>
                    <mat-icon (click)="openQuestionsDialog('Update', l2)" matTooltip="Edit This Question"
                      matTooltipClass="tooltip-blue" matTooltipPosition="above">edit
                    </mat-icon>
                    <mat-icon (click)="openQuestionsDialog('View', l2)" matTooltip="View Question"
                      matTooltipClass="tooltip-blue" matTooltipPosition="above">visibility
                    </mat-icon>
                  </mat-card-actions>

                  <ng-container *ngFor="let l3 of currentCategory.questions | subQuestions: l2.id; let k = index">
                    <mat-card class="level2">
                      <button *ngIf="l3.answer_opt == 1" mat-mini-fab color="primary">Yes</button> <button mat-mini-fab
                        color="warn" *ngIf="l3.answer_opt == 2">No</button> <button *ngIf="l3.answer_opt == 3" mat-mini-fab
                        class="both">Both</button> {{k+1}}. {{l3.question}}
                      <mat-card-actions>
                        <mat-icon matTooltip="Delete This Questions" matTooltipClass="tooltip-blue"
                          matTooltipPosition="above" (click)="openQuestionsDialog('Delete', l3)">delete</mat-icon>
                        <mat-icon (click)="openQuestionsDialog('Update', l3)" matTooltip="Edit This Question"
                          matTooltipClass="tooltip-blue" matTooltipPosition="above">edit
                        </mat-icon>
                        <mat-icon (click)="openQuestionsDialog('View', l3)" matTooltip="View Question"
                          matTooltipClass="tooltip-blue" matTooltipPosition="above">visibility
                        </mat-icon>
                      </mat-card-actions>
                    </mat-card>
                  </ng-container>
                </mat-card>
              </ng-container>
            </mat-card>
          </ng-container>

        </mat-panel-description>
      </mat-expansion-panel>
    </ng-container>
  </mat-accordion>


</div>